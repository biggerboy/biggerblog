---
date: 2022-08-15
category:
  - JVM
tag:
  - GC
---



# GC垃圾回收

## What is GC?

什么是GC？为了便于理解GC的概念，我摘抄了百度百科的解释，如下

>GC（Garbage Collection)：JAVA/[.NET](https://baike.baidu.com/item/.NET)中的垃圾回收器。Java是由[C++](https://baike.baidu.com/item/C%2B%2B)发展来的。它摈弃了C++中一些繁琐容易出错的东西。其中有一条就是这个GC。
>
>在老式的C/C++程序中，程序员定义了一个变量，就是在内存中开辟了一段相应的空间来存值。由于内存是有限的，所以当程序不再需要使用某个变量的时候，就需要销毁该对象并释放其所占用的内存资源，好重新利用这段空间。在C/C++中，释放无用变量内存空间的事情需要由程序员自己来处理。就是说当程序员认为变量没用了，就手动地释放其占用的内存。但是这样显然非常繁琐，如果有所遗漏，就可能造成资源浪费甚至[内存泄露](https://baike.baidu.com/item/内存泄露)。当软件系统比较复杂，变量多的时候程序员往往就忘记[释放内存](https://baike.baidu.com/item/释放内存/10736171)或者在不该释放的时候释放内存了。
>
>有了GC，程序员就不需要再手动的去控制内存的释放。当[Java虚拟机](https://baike.baidu.com/item/Java虚拟机/6810577)（VM）或.NET[CLR](https://baike.baidu.com/item/CLR)发觉内存资源紧张的时候，就会自动地去清理无用对象（没有被引用到的对象）所占用的内存空间（这里的说法略显粗略，事实上何时清理内存是个复杂的策略）。如果需要，可以在程序中显式地使用System.gc() / System.GC.Collect（）来强制进行一次立即的内存清理。[Java](https://baike.baidu.com/item/Java/85979)提供的GC功能可以自动监测对象是否超过了作用域，从而达到自动回收内存的目的，Java的GC会自动进行管理，调用方法：System.gc() 或者Runtime.getRuntime().gc();

这几段话解释了3个问题，1）什么是垃圾回收？ 2）为什么需要垃圾回收？ 3）垃圾回收需要程序员去做吗？

正如上文所述，“有了GC，程序员就不需要再手动的去控制内存的释放。”，这也是Java这门高级语言的一大特点，“可以自动监测对象是否超过了作用域，从而达到自动回收内存的目的，Java的GC会自动进行管理”，解放了程序员去做这些繁琐的并且容易出错的工作。（PS：Java自动管理内存进行垃圾回收，不代表就不会出现**内存泄露**的问题 ）

## GC算法分类

### 1、标记-清除算法

标记清除算法分为两个阶段，标记阶段和清除阶段。

**标记阶段：**扫描内存，将垃圾对象标记出来（不同的垃圾收集器可能实现不同，有的是标记存活对象）。

**清除阶段：**将标记的对象清除。

**优点：**效率高。

**缺点：**会造成内存碎片，可能造成需要连续内存的对象放不下

### 2、复制算法

复制算法将内存分为两部分，每次只使用其中一半，GC时将存活的对象复制到未使用的那一半内存中，然后直接把当前这一半内存的对象直接删除。

**缺点：**每次只能使用一半内存，是一种浪费

**优点：**只需要少量的复制即可，效率高

### 3、标记-整理算法

标记整理算法比标记清除算法多了一步整理的操作，是为了解决内存碎片问题。它的标记阶段和标记清除算法的标记阶段一样， 标记完会进行内存整理，将存活对象往内存的一端移动，然后清除垃圾对象。

**优点：**解决了内存碎片问题

**缺点：**多了一步整理，效率会比标记清除算法低

### 4、分代收集算法

分代收集算法并不是一种新的算法，它是根据Java堆内存不同代的划分以及不同代的特点采用不同垃圾收集算法的思想。例如，年轻代使用复制算法，老年代采用标记清除或标记整理算法。不同的垃圾收集器采用的收集算法可能不一样。

## 垃圾收集器

### 什么是垃圾收集器？和垃圾收集算法的关系是？

如果说垃圾收集算法是JVM垃圾收集的方法论，那么垃圾收集器就是JVM垃圾收集的具体实现，垃圾收集算法是指导思想，垃圾收集器是成果。

JVM经历了不断的迭代，有不少的垃圾收集器被设计出来，为什么要设计那么多的垃圾收集器呢？没有最好的只有更好的，只有适合自己业务的。我们都知道JVM做垃圾收集时都会有停顿，即stop the world，意思就是用户线程会停止，去执行垃圾收集线程，那么垃圾收集的时间越长对用户线程的执行影响越大，用户体验就越差，jvm的开发者之所以设计那么多的垃圾收集器，其实是在不断的探索性能更高的垃圾收集器，不断的缩短这个STW时间，已达到更好的用户体验。

下面就简单介绍一下各种垃圾收集器的原理及优缺点。

### 1、Serial收集器



### 2、ParNew收集器



###		3、Parallel Scavenge收集器



###		4、CMS收集器



###		5、G1收集器



###		6、ZGC收集器





关注公众号@BiggerBoy，让我们一起成长吧！

<img :src="$withBase('/img/qcode.jpg')" alt="微信搜索BiggerBoy">